# 个人实践心得体会

- 整个实验进行的过程详细记录在[个人开发日志](./个人开发日志.md)

## 主要贡献

- 完整复现出 [网络安全 (2021) 综合实验](https://www.bilibili.com/video/BV1p3411x7da) 流程
- 完成 `红队 | 漏洞存在性验证、漏洞利用` 
- - Log4j2 漏洞利用
- - 多网段渗透场景 漏洞利用
- 完成 `蓝队-威胁监测 | 持续监测漏洞利用、威胁识别与报告`
- - `suricata` 实时监测恶意流量
- - `zeek` `wireshark` 分析 `tcpdump` 抓包的流量
- 协助完成 `蓝队-威胁处置 | 缓解漏洞利用`
- - 缓解 `Log4j2` 漏洞利用并重新制作镜像
- `自动化攻击脚本`的编写
- - [bash 脚本](../code/lihan_code/auto/auto_atk_1.sh) 一键攻击 `Log4j2` 漏洞

## 技术难点

### log4j2 漏洞利用

1. 攻击请求由 POST 请求改为 GET 请求

将攻击过程由教材中的 POST 请求改为 GET 请求，涉及命令、部分代码修改，详细记录在[个人开发日志——7.9](./个人开发日志.md#2479-vulfocus-和单个-漏洞靶标攻防-初探log4j2-cve-2021-44228)及[个人开发日志——7.10](./个人开发日志.md#24710--漏洞靶标攻防-深入)。

2. `log4j2` 漏洞利用自动化

从多行命令改为[单行命令](./个人开发日志.md#24710--漏洞靶标攻防-深入)，进一步编写为 [`bash` 脚本](./个人开发日志.md#自动化脚本攻击) ，利用 tmux 实现脚本中包含自动化开启 nc 监听端口、启动 JNDIExploit 等。

### 多网段渗透场景

1. 配置和使用 `zeek` 分析 `tcpdump` 抓包的流量

成功从源码安装 zeek ，并分析 `tcpdump` 抓包的流量，找到恶意流量，详细记录在[个人开发日志——7.11](./个人开发日志.md#24715-16-多网段渗透场景攻防-流量分析)。

## 重点问题解决

1. `log4j-scan.py` 无法运行

- 修改 GET 请求的代码，将键 `v` 改为 `payload`，解决报错，详见[个人开发日志#漏洞可利用性检测](./个人开发日志.md#漏洞可利用性检测)。

- 增加 `--dns-callback-provider dnslog.cn` 参数，使用 `dnslog.cn` 作为 DNS 回调服务器，解决`log4j-scan.py` 代码中 `interact.sh` 服务器只能通过 HTTP 访问，而脚本默认使用 HTTPS 访问导致的报错，详见[个人开发日志#2-log4j-scanpy-报错](./个人开发日志.md#2-log4j-scanpy-报错)。

2. 重新构建容器镜像

- 重构 nginx-php-flag 镜像解决容器启动失败问题和漏洞缓解后重构镜像，利用 dockerfile 及 `docker commit` `docker build` 等命令重新构建镜像，详见[个人开发日志#nginx-php-flag-镜像的容器启动失败](./个人开发日志.md#nginx-php-flag-镜像的容器启动失败)和[小组报告-#漏洞缓解与修复](../docs/网络安全综合实践小组报告.md#漏洞缓解与修复)。
